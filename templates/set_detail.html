{% extends "base.html" %}

{% block title %}{{ f1.name }}{% endblock %}

{% block content %}
  <!-- ===== CH·ª¶ ƒê·ªÄ 2 ===== -->
  {% if not selected_folder2 %}
    <div class="card" id="block2">
      <h3>{{ f1.name }}</h3>

      <div class="topic-list">
        {% for f2 in folder2_list %}
          <a href="{{ url_for('view_set',
                              folder1_id=f1.id,
                              folder2_id=f2.id) }}"
             class="card-square">

            <div class="card-image">
              <img src="{{ url_for('static',
                filename=(f2.image|replace('\\','/'))
              ) }}">
            </div>

            <div class="card-title">{{ f2.name }}</div>
          </a>

        {% endfor %}
      </div>
    </div>
  {% endif %}


  {% if selected_folder2 %}

    {% if folder3_list|length == 0 %}
      <div class="card">
        <h3>Ch∆∞a c√≥ ch·ªß ƒë·ªÅ c·∫•p 3</h3>
        <p>V√†o Admin ƒë·ªÉ t·∫°o Folder c·∫•p 3 trong Ch·ªß ƒë·ªÅ 2.</p>
      </div>

    {% else %}

      <!-- ===== CH·ª¶ ƒê·ªÄ 3 ===== -->
      <div class="card" id="block3">
        <h3>{{ selected_folder2.name }}</h3>

        <div class="topic-list">
          {% for f3 in folder3_list %}
            <a href="javascript:void(0)"
               class="card-square"
               onclick="openStartModal(
                 '{{ f3.name }}',
                 '{{ url_for('quiz_start_folder', folder3_id=f3.id) }}'
               )">

              <div class="card-image">
                <img src="{{ url_for('static',
                  filename=(f3.image|replace('\\','/'))
                ) }}">
              </div>

              <div class="card-title">{{ f3.name }}</div>
            </a>
          {% endfor %}
        </div>
      </div>


      <!-- ===== MODAL B·∫ÆT ƒê·∫¶U √îN T·∫¨P ===== -->
      <div class="modal" id="startModal">
        <div class="modal-backdrop" onclick="closeStartModal()"></div>

        <div class="modal-box modal-start">
          <div class="modal-header">
            <b>üéØ B·∫Øt ƒë·∫ßu √¥n t·∫≠p</b>
            <button class="icon-btn" onclick="closeStartModal()">‚úñ</button>
          </div>

          <div class="modal-body" style="text-align:center;">
            <h2 id="modalTopicName" style="margin:10px 0 24px;"></h2>

            <a id="startQuizBtn"
               class="btn"
               style="font-size:20px; padding:16px 44px;">
              ‚ñ∂ B·∫ÆT ƒê·∫¶U
            </a>
          </div>
        </div>
      </div>

    {% endif %}
  {% endif %}

  <div style="margin-top:16px; display:flex; justify-content:flex-end;">
    <a class="btn" href="javascript:history.back()">‚Üê Quay l·∫°i</a>
  </div>

{% endblock %}


{% block scripts %}

<!-- ===== COUNTDOWN OVERLAY ===== -->
<div id="countdownOverlay" class="countdown-overlay">
  <div id="countdownNumber" class="countdown-number">3</div>
</div>

<script>
  let isCountingDown = false;   <!-- ‚úÖ ƒê·∫∂T NGAY D√íNG N√ÄY -->

  {% if selected_folder2 %}
    const b3 = document.getElementById("block3");
    if (b3) b3.scrollIntoView({ behavior: "smooth", block: "start" });
  {% endif %}

  let startUrl = "";

  function openStartModal(topicName, url){
    startUrl = url;
    document.getElementById("modalTopicName").textContent = topicName;
    document.getElementById("startModal").classList.add("show");
  }

  function closeStartModal(){
    document.getElementById("startModal").classList.remove("show");
  }

  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("startQuizBtn");
    if (btn) {
      btn.onclick = () => {
        closeStartModal();
        startCountdown();
      };
    }
  });

  function startCountdown(){
    if (isCountingDown) return;
    isCountingDown = true;

    const overlay = document.getElementById("countdownOverlay");
    const num = document.getElementById("countdownNumber");
    overlay.style.display = "flex";

    const steps = ["3","2","1","B·∫ÆT ƒê·∫¶U"];
    let i = 0;

    num.textContent = steps[i];

    const timer = setInterval(()=>{
      i++;
      if (i >= steps.length) {
        clearInterval(timer);
        setTimeout(()=>{
          window.location.href = startUrl;
        },700);
        return;
      }

      num.textContent = steps[i];
      num.style.animation = "none";
      num.offsetHeight;
      num.style.animation = "pop 1s ease";

    },1000);
  }
</script>

{% endblock %}

