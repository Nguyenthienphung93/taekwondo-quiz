{% extends "base.html" %}
{% block content %}

<div class="quiz-wrapper">

  <!-- üîπ CH·ª¶ ƒê·ªÄ (an to√†n, kh√¥ng crash) -->
  <div class="quiz-topic">
    Ch·ªß ƒë·ªÅ: {{ question.folder.name if question.folder else "√în t·∫≠p" }}
  </div>

  <!-- üîπ KHUNG GAME -->
  <div class="quiz-card">

    <!-- ‚è± TIMER -->
    <div class="timer-box">
      <div id="timer">20</div>
      <span>gi√¢y</span>
    </div>

    <!-- üîπ TI·∫æN TR√åNH -->
    <div class="quiz-progress">
      C√¢u h·ªèi {{ progress[0] + 1 }} / {{ progress[1] }}
    </div>

    <!-- ‚ùì C√ÇU H·ªéI -->
    <div class="quiz-question">
      {{ question.text }}
    </div>

    <!-- üéØ ƒê√ÅP √ÅN -->
    <form method="POST" id="quiz-form">
      <div class="answers-grid">
        {% for c in question.choices %}
        <label class="answer-btn">
          <input type="radio" name="choice_id" value="{{ c.id }}">
          <span>{{ ['A','B','C','D'][loop.index0] }}. {{ c.text }}</span>
        </label>
        {% endfor %}
      </div>

      <!-- ‚ñ∂Ô∏è TI·∫æP THEO -->
      <div class="next-btn-box">
        <button type="submit" class="next-btn">Ti·∫øp theo</button>
      </div>
    </form>

  </div>
</div>

<!-- ‚è≥ TIMER SCRIPT -->
<script>
const timePerQ = {{ time_per_q if time_per_q else "null" }};
const form = document.getElementById("quiz-form");

if (timePerQ !== null) {
    let seconds = timePerQ;
    const el = document.getElementById("timer");

    if (el && form) {
        el.textContent = seconds;

        const tick = setInterval(() => {
            seconds--;
            el.textContent = seconds;

            if (seconds <= 5) {
                el.style.color = "red";
            }

            if (seconds <= 0) {
                clearInterval(tick);
                form.submit();
            }
        }, 1000);
    }
}
</script>

{% endblock %}
